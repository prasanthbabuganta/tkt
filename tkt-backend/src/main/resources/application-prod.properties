# ================================================================
# TKT Backend - Production Environment Configuration
# Active Profile: prod
# GCP Region: asia-south1 (Mumbai, India)
# Usage: -Dspring.profiles.active=prod or SPRING_PROFILES_ACTIVE=prod
# ================================================================

# Database Configuration (GCP Cloud SQL - Production)
# MUST use environment variables - no defaults
spring.datasource.url=${DB_URL}
spring.datasource.username=${DB_USERNAME}
spring.datasource.password=${DB_PASSWORD}

# Cloud SQL Socket Factory (for GCP deployment)
spring.cloud.gcp.sql.enabled=true
spring.cloud.gcp.sql.database-name=tkt
spring.cloud.gcp.sql.instance-connection-name=${CLOUD_SQL_INSTANCE:tkt-backend-prod:asia-south1:tkt-db-prod}

# JPA/Hibernate - Production Settings
# IMPORTANT: Use 'validate' in production to prevent schema changes
spring.jpa.hibernate.ddl-auto=${DDL_AUTO:validate}
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false

# Performance Optimizations
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.query.in_clause_parameter_padding=true

# Logging - Production level (INFO/WARN/ERROR only)
logging.level.root=INFO
logging.level.com.example.thekingstemple=INFO
logging.level.org.springframework.security=WARN
logging.level.org.springframework.web=WARN
logging.level.org.hibernate=WARN

# Structured JSON Logging for GCP Cloud Logging
# Uncomment if using logback-spring.xml for JSON logging
# logging.config=classpath:logback-spring.xml

# JWT Configuration - MUST use environment variables
jwt.secret=${JWT_SECRET}
jwt.access-token-expiry=${JWT_ACCESS_TOKEN_EXPIRY:2592000000}
jwt.refresh-token-expiry=${JWT_REFRESH_TOKEN_EXPIRY:5184000000}

# Encryption - MUST use environment variable
encryption.secret.key=${ENCRYPTION_SECRET_KEY}

# Admin Seed - MUST use environment variables
admin.seed.mobile=${ADMIN_SEED_MOBILE}
admin.seed.pin=${ADMIN_SEED_PIN}

# Actuator - Minimal exposure for production security
management.endpoint.health.show-details=when-authorized
management.endpoints.web.exposure.include=health,info,metrics,prometheus
management.endpoint.health.probes.enabled=true

# Liveness and Readiness Probes for Cloud Run
management.health.livenessstate.enabled=true
management.health.readinessstate.enabled=true

# Error Handling - Never expose stack traces in production
server.error.include-stacktrace=never
server.error.include-exception=false
server.error.include-message=always

# Connection Pool - Optimized for production
spring.datasource.hikari.maximum-pool-size=${DB_POOL_SIZE:20}
spring.datasource.hikari.minimum-idle=${DB_MIN_IDLE:10}
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.leak-detection-threshold=60000

# GCP Cloud Run specific configurations
# Graceful shutdown
server.shutdown=graceful
spring.lifecycle.timeout-per-shutdown-phase=30s

# Compression for bandwidth optimization
server.compression.enabled=true
server.compression.mime-types=application/json,application/xml,text/html,text/xml,text/plain

# Security Headers
server.error.whitelabel.enabled=false

# Timezone - India Standard Time
spring.jackson.time-zone=Asia/Kolkata
user.timezone=Asia/Kolkata

# Scheduler - Production settings
spring.task.scheduling.pool.size=2

# Performance monitoring
spring.jpa.properties.hibernate.generate_statistics=false
